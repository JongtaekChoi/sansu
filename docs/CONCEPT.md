# Sansu — 앱 구조 & 문제 생성 컨셉

이 문서는 **저학년 산수 웹앱(Sansu)**의 현재 구조와, 문제(콘텐츠)를 어떻게 “데이터/규칙 기반”으로 생성하는지 설명한다.

> 목표: 레슨을 손으로 하나씩 만들지 않고, **템플릿 + 파라미터 + 랜덤 시드(seed)**로 자동 생성한다.

---

## 0) 현재 MVP 요약

- 대상: 초등 1~3학년 (현재 MVP는 1학년 덧셈 시작)
- UX: 태블릿 중심, 1:1 스테이지(보드) + 선택형(4지선다)
- 레슨: 1레슨 = 6문제
- 입력: 현재는 **객관식만** 사용(키패드 제거)
- 힌트: 텍스트는 최소/제거, 향후 SVG 애니메이션으로 대체 예정
- 배포: Vercel (main 브랜치 자동 배포)

---

## 1) 앱 구조(화면/컴포넌트)

### 1.1 Stage 중심 UI
- 화면 중앙에 **1:1 스테이지(보드)**를 둔다.
- 문제 프롬프트(식/도형), 보기(2×2 버튼), 정답/오답 효과(색/사운드)도 스테이지 안에서 해결한다.

### 1.2 Dev 패널
- 일반 사용자에게는 숨기고, 개발/디버그용으로만 노출한다.
- URL `?dev=1`일 때만 레슨 선택/seed/시작 등 제어 패널을 보여준다.

### 1.3 컴포넌트
- `Stage` : 보드(정답/오답 pulse)
- `ProgressDots` : 6문제 진행 표시
- `Choices` : 2×2 객관식 버튼
- `RenderView` : 도형 기반(사각형/점) 문제 렌더링(SVG)

---

## 2) 콘텐츠 구조(Unit → Lesson → Problem)

### 2.1 Unit
- 학습 주제 묶음.
- 예: `U1-1` (0~10 덧셈)

### 2.2 Lesson
- 한 번에 푸는 문제 묶음.
- 현재: 1레슨 = 6문제 고정(추후 변경 가능)

### 2.3 Problem
- 레슨을 구성하는 개별 문제.
- 현재 문제는 2종류:
  1) `ARITH_CHOICE`: 산술(예: a+b) + 4지선다
  2) `RENDER_CHOICE_COUNT`: 도형(사각형/점) 개수 세기 + 4지선다

---

## 3) 스펙 파일(JSON) — “규칙”이 들어있는 곳

### 3.1 lessonDefs.json
- 레슨 메타데이터 목록.
- 레슨이 어떤 난이도(stage)인지, 최대 합(maxSum), focus가 무엇인지 정의한다.

경로:
- `specs/u1-1/lessonDefs.json`
- 빌드 import 편의를 위해 `src/specs/u1-1/lessonDefs.json`에도 복사되어 있다.

### 3.2 generatorParams.json
- 문제 생성기 공통 파라미터.

포함 항목(요약):
- 레슨당 문제 수(6)
- 객관식 오답 생성 규칙
- antiRepeat(중복 방지)
- renderMix(도형 문제 섞기 비율)

경로:
- `specs/u1-1/generatorParams.json`
- `src/specs/u1-1/generatorParams.json`

---

## 4) 시드 기반 자동 생성(재현 가능성)

### 4.1 mulberry32
- `mulberry32(seed)`는 seed 기반 의사난수 생성기(PRNG)다.
- 같은 seed를 사용하면 같은 난수열이 나오므로 **같은 레슨/같은 seed = 같은 문제 세트**를 재현할 수 있다.

### 4.2 URL 공유
- `lesson`, `seed`, `i`(현재 문제 index)를 URL에 유지한다.
- 문제 풀이 중에도 `history.replaceState`로 URL이 갱신된다.

예시:
- `/?lesson=U1-1-L07&seed=12345&i=3`
- `autostart`를 붙이면 링크 열자마자 문제 생성 시작:
  - `/?lesson=U1-1-L07&seed=12345&autostart=1`

---

## 5) 객관식(4지선다) 보기 생성 전략

### 5.1 기본 후보
- 정답을 기반으로 한 흔한 오답 후보를 만든다.
  - `ans±1`, `ans±2`, `a`, `b`, `|a-b|` 등

### 5.2 항상 4개 보장
- 필터링/중복 제거로 후보가 부족해질 수 있다(특히 정답이 0/작은 값일 때).
- 따라서 “휴리스틱 후보”가 부족하면:
  1) `[min..max]` 범위에서 남는 숫자로 채우고
  2) 필요하면 범위를 조금 확장해 채우며
  3) 최후에는 중복을 허용해서라도 4개를 맞춘다.

목표:
- **절대 무한루프/멈춤 없이** 4지선다를 제공

---

## 6) 도형(렌더) 기반 문제 컨셉

이미지 파일(에셋)을 두지 않고, **도형을 데이터로 정의(RenderSpec)**하여 SVG로 렌더링한다.

### 6.1 RenderSpec
- `gridRect`: rows×cols 사각형 배열 (곱셈/배열 직관)
- `arrayDots`: count개 점/블록 배열 (개수 세기)

### 6.2 색상
- 문제마다 1색을 랜덤 선택한다.
- 토큰(c1~c8)을 팔레트(HEX)에 매핑한다.

### 6.3 U1에서 섞기
- `renderMix.rate`로 레슨 내 도형 문제 삽입 확률을 제어한다.
- 위치는 고정하지 않고, 레슨 내 임의 슬롯에 넣는다.

---

## 7) 안정성(멈춤 방지) 원칙

- 생성기에는 총 시도 횟수 제한 등 안전장치를 둔다.
- JSON 파라미터는 lazy import 시 `default` 포맷 이슈가 발생할 수 있으므로,
  - `mod.default ?? mod`
  - Zod 스키마 검증
  으로 런타임에서 빠르게 실패하도록 한다.

---

## 8) 다음 단계(로드맵)

- 힌트: 텍스트 대신 SVG 애니메이션(블록 이동/붙이기)
- 저장: 로컬(IndexedDB) 기반 진도/오답 기록
- 월드맵: Unit/Lesson 잠금 해제(레벨/스테이지 기반)
- 문제 타입 확장:
  - 곱셈 gridRect(3×4는 몇 개?)
  - 분수(분할 도형)
  - 드래그/매칭(추후)
